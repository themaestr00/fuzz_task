# Отчет о проделанной работе
## 1. Изучение материалов, сборка AFL++
Первым делом изучил документацию к фаззерам [AFL](https://github.com/google/AFL) и [AFL++](https://github.com/AFLplusplus/AFLplusplus). Далее установил пакет AFL++ через пакетный менеджер: ```sudo apt install afl++```.
## 2. Тестовый фаззинг
Написал небольшую программу на C (hello.c) с использованием оператора if, в одно из ветвлений добавил вызов abort(). Результаты работы фаззера описал в каталоге [small_sample](https://github.com/themaestr00/fuzz_task/tree/main/small_sample).
## 3. Выбор таргета для фаззинга и написание касмотного мутатора
В качестве таргета выбрал проект [agrep](https://github.com/Wikinaut/agrep), так как он работает с текстовыми данными, которые довольно просто модифицировать. Собрал бинарник с помощью afl-cc. Далее написал кастомный мутатор [my_mutator.py](https://github.com/themaestr00/fuzz_task/tree/main/my_mutator). Мутатор добавляет/заменяет произвольные силы в паттерн, передаваемый agrep. Чтобы найти больше путей, отдельный приоритет отдал метасимволам, которые используются в agrep.
## 4. Тестовый запуск фаззера без кастомного мутатора
Решил сначала тестово запустить фаззер без мутатора. Запуск произошел без неожиданностей.
## 5. Одиночный запуск фаззера с кастомным мутатором
Далее начал подготовку к запуску фаззера с применением кастомного мутатора. Для запусков решил увеличить число передаваемых аргументов командной строки, чтобы, возможно, найти новые пути выполнения программы. (В процессе также была попытка мутации аргументов командной строки, но она на этот раз не была успешной).
## 6. Параллельный запуск фаззеров с кастомным мутатором
Далее запустил 2 процесса afl-fuzz с аналогичными аргументами. Удалось найти большее число путей по сравнению с одиночным запуском. Также были найдены 12 различных падений - [crashes](https://github.com/themaestr00/fuzz_task/tree/main/crashes).
## 7. Найденные падения
Все файлы с шаблонами, которые вызвали падения agrep, перенес в папку crashes (ссылка выше) для дальнейшей проверки работы agrep. Падения действительно были получены при определенных комбинациях аргументов вызова agrep. Пример ниже. 

*Пример падения*

![image](https://github.com/user-attachments/assets/6d5d97bc-f66c-4c32-9fb3-e6e1d2758805)
## 8. Фаззинг аргументов командной строки
Ввиду низкой эффективности фаззинга шаблонов для agrep решил подробнее изучить, как проводить фаззинг аргументов командной строки, иными словами, как менять argv в процессе фаззинга. Такая возможность есть - [argv_fuzzing](https://github.com/AFLplusplus/AFLplusplus/tree/stable/utils/argv_fuzzing). Аргументы командной строки передаются через stdin, разделитель - нулевой байт. С помощью вспомогательной Си программы - [input creator](https://github.com/themaestr00/fuzz_task/tree/main/input_creator) - смог сформировать новый набор входных данных. Также сформировал новый бинарник, для этого немного изменил исходный код agrep, добавив туда соответсвующий include и вызов AFL_INIT_ARGV(). Полученный бинарник - agrep-argv. Для чистоты эксперимента падения, полученные при фаззинге, проверял на стандартной версии agrep.
## 9. Доработки мутатора
Прошлый мутатор был менее эффективен и не мог корректно менять argv для agrep. Мутатор доработал и добавил в него работу с аргументами командной строки (добавление и удаление). Также распределил веса для соответствующих команд, чтобы отдельные команды получили больший приоритет. Подробнее в [my_mutator](https://github.com/themaestr00/fuzz_task/tree/main/my_mutator).
## 10. Запуск с мутатором и сравнение с запуском без мутатора
Запустил на длительное время фаззер с моим мутатором и без него. Выставил переменную AFL_CUSTOM_MUTATOR_ONLY, так как без моего мутатора входные данные очень сильно ломаются. Запустил фаззер, параллельно запустил фаззер без моего мутатора. Спустя примерно час работы фаззер без мутатора практически перестал находить новые инпуты, в то же время фаззер с мутатором продолжал стабильно их выдавать. Итоговые показатели найденных путей и покрытие (43% против 22.5%) были выше у фаззера с мутатором. P. S. Процесс остановил, когда фаззер с мутатором завершил первый цикл.

*Запуск фаззера с мутатором*

![изображение](https://github.com/user-attachments/assets/32867ea4-4003-44ba-90db-17bd2e5cac6b)

*fuzzer stats*

![изображение](https://github.com/user-attachments/assets/6cad2951-6ea0-40a6-a875-a96d7f283140)

*Запуск фаззера без мутатора*

![изображение](https://github.com/user-attachments/assets/cefe5237-3ec1-44aa-8532-bd1ecca7a06f)

*fuzzer stats*

![изображение](https://github.com/user-attachments/assets/f9e8b080-95d1-44dc-a2e0-3bf5ddcf1ae4)\

Подробнее можно изучить в [argv_mut](https://github.com/themaestr00/fuzz_task/tree/main/argv_mut) и [argv_no_mut](https://github.com/themaestr00/fuzz_task/tree/main/argv_no_mut).
Соответственно было найдено 39 и 141 падение. Насчет падений, найденных без мутатора, есть сомнения, так как входные данные очень сильно искажены и такой инпут нереально воспроизвести. Найденные же с помощью кастомного мутатора падения воспроизводятся легко и именно такие падения обнаруживаются только моим мутатором. Падения проверял по результатам запуска параллельных фаззеров.
Также сравнение при фаззинге аргументов командной строки и просто шаблонов:

*Фаззинг командной строки*

![изображение](https://github.com/user-attachments/assets/9b254eaf-fcf1-485c-8c60-8fe79b27f3f9)

*Фаззинг файла с паттерном*

![изображение](https://github.com/user-attachments/assets/ec1e6b80-c444-4f36-9113-7134ae8a8b73)

## 11. Параллельный запуск
В конце решил запустить 4 параллельных процесса afl-fuzz, в результате получил больше найденных путей и большее покрытие за меньшее время.

*fuzzer01*

![изображение](https://github.com/user-attachments/assets/f3c88682-950d-48a0-b4fb-b72042e94b10)

*fuzzer02*

![изображение](https://github.com/user-attachments/assets/3b55dffc-94ab-4c0b-b718-237e3f87ade9)

*fuzzer03*

![изображение](https://github.com/user-attachments/assets/ff9e74a6-a686-4789-bce4-5284af281954)

*fuzzer04*

![изображение](https://github.com/user-attachments/assets/56cfbc75-d1b6-475d-b4b6-d25685e4ba04)

Подробнее - [argv_mut_multi](https://github.com/themaestr00/fuzz_task/tree/main/argv_mut_multi).
## 12. Некоторые из найденных падений
![изображение](https://github.com/user-attachments/assets/07dd168c-d241-435d-9c0a-bbe8a4147274)
![изображение](https://github.com/user-attachments/assets/d6d02c55-c17f-4bb1-8def-10db0d9d76ab)
![изображение](https://github.com/user-attachments/assets/4243fac6-4b29-4245-bab9-ca4b9fff0a04)
![изображение](https://github.com/user-attachments/assets/7ffc3308-b74b-4d58-a9a7-4eaac447b303)
![изображение](https://github.com/user-attachments/assets/9cad795c-6aa6-418c-aea5-aa84405f228c)
![изображение](https://github.com/user-attachments/assets/2777ba5d-a646-4ec1-8880-3aa9b7ff6b37)
## 13. Улучшаю мутатор
Сосредоточившись на мутации файла с паттерном, улучшал мутатор, пробуя новые варианты мутаций, настраивая рандом исходя из длины уже имеющегося паттерна. В результате долгих сравнений остановился на варианте, описанном в [my_mutator_file.py](https://github.com/themaestr00/fuzz_task/blob/main/my_mutator/my_mutator_file.py). 
## 14. Новые запуски и сравнения
Убрал прошлые наработки ввиду их неактуальности. Запустил фаззинг с мутатором и без него. В этот раз решил не добавлять никаких аргументов командной строки, кроме -f, который позволяет считывать шаблон из файла. Ниже сравнения запусков, сильного прироста не получилось, но удалось найти падения в отличие от запуска без мутатора.

*Запуск фаззера с мутатором*

![image](https://github.com/user-attachments/assets/3579604c-5988-45f9-83f9-5d3d9d5c963a)

*fuzzer stats*

![image](https://github.com/user-attachments/assets/b3c3ba83-1f3f-491b-9e31-30e5bdf6a51c)

*Запуск фаззера без мутатора*

![image](https://github.com/user-attachments/assets/225ff26d-dd69-4e42-b967-6afda23e2b9b)

*fuzzer stats*

![image](https://github.com/user-attachments/assets/ee1ff6c8-c98c-4c41-b728-97eb13e770bd)

Подробнее: запуск с мутатором - [file_mut](https://github.com/themaestr00/fuzz_task/tree/main/file_mut), запуск без мутатора - [file_no_mut](https://github.com/themaestr00/fuzz_task/tree/main/file_no_mut). 
## 15. Параллельный запуск
Запустил 4 параллельных процесса afl-fuzz с моим мутатором. Результат ниже:

*fuzzer01*

![image](https://github.com/user-attachments/assets/f38e2d8b-9050-429a-b8c5-1735331e7125)

*fuzzer02*

![image](https://github.com/user-attachments/assets/ab9422ab-bbc4-4460-aeaf-fbb58061fd6b)

*fuzzer03*

![image](https://github.com/user-attachments/assets/85e5cacb-ec99-44d6-9a8b-521d69985010)

*fuzzer04*

![image](https://github.com/user-attachments/assets/b6da1b70-31e6-4990-b375-28a1936c25e5)

Подробнее - [file_mut_multi](https://github.com/themaestr00/fuzz_task/tree/main/file_mut_multi)


